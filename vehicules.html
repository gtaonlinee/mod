<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>itsmto • Garage</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-body: #f5f3ff;
            --text-main: #1e1b4b;
            --text-muted: #64748b;
            --nav-bg: #ffffff;
            --card-bg: #ffffff;
            --card-border: #c4b5fd;
            --btn-color: #725AC1;
            --shadow-tone: rgba(114, 90, 193, 0.15);
        }

        body { margin: 0; padding: 0; font-family: 'Inter', sans-serif; background: var(--bg-body); color: var(--text-main); }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 24px; }

        /* --- NAVIGATION --- */
        .navbar {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            width: 95%; max-width: 1200px; border-radius: 30px;
            background: var(--nav-bg); padding: 10px 30px; z-index: 1000;
            border: 1px solid var(--card-border);
            box-shadow: 0 10px 30px -10px var(--shadow-tone);
            box-sizing: border-box;
        }
        .nav-inner { display: flex; justify-content: space-between; align-items: center; }
        .logo { font-weight: 800; font-size: 22px; color: var(--btn-color); text-decoration: none; }
        .nav-links { display: flex; gap: 20px; }
        .nav-links a { text-decoration: none; color: var(--text-muted); font-size: 14px; font-weight: 500; transition: 0.3s; }
        .nav-links a:hover, .nav-links a.active { color: var(--btn-color); }
        
        .menu-toggle { display: none; background: none; border: none; font-size: 28px; color: var(--btn-color); cursor: pointer; }
        .mobile-menu { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-body); z-index: 2000; flex-direction: column; align-items: center; justify-content: center; gap: 40px; }
        .mobile-menu a { font-size: 32px; font-weight: 800; text-decoration: none; color: var(--text-main); }
        .close-menu { position: absolute; top: 30px; right: 30px; font-size: 40px; background: none; border: none; color: var(--text-main); cursor: pointer; }
        
        @media (max-width: 768px) {
            .nav-links { display: none; }
            .menu-toggle { display: block; }
        }

        /* --- RECHERCHE & CONTROLES --- */
        .search-section { margin-top: 160px; text-align: center; padding: 0 20px; }
        
        .search-wrapper {
            display: flex; justify-content: center; gap: 10px; margin-bottom: 25px; flex-wrap: wrap;
        }

        .search-input {
            width: 100%; max-width: 400px; padding: 15px 25px; border-radius: 50px;
            border: 2px solid var(--card-border); background: #ffffff; color: var(--text-main);
            font-size: 16px; outline: none;
            box-shadow: 0 10px 20px -10px var(--shadow-tone); transition: 0.3s;
        }
        .search-input:focus { border-color: var(--btn-color); box-shadow: 0 10px 25px -5px rgba(114, 90, 193, 0.3); }

        /* Bouton Filtre (Design demandé) */
        .advanced-filter-btn {
            background-color: #ffffff; color: var(--btn-color); font-size: 15px; font-weight: 600;
            padding: 0 25px; border: 2px solid var(--card-border); border-radius: 50px; cursor: pointer;
            display: flex; align-items: center; gap: 8px; transition: all 0.2s;
            box-shadow: 0 10px 20px -10px var(--shadow-tone);
        }
        .advanced-filter-btn:hover { background-color: var(--btn-color); color: white; border-color: var(--btn-color); }
        .advanced-filter-btn.active-filter { background-color: var(--btn-color); color: white; }

        .garage-tabs { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; }
        .tab-btn {
            background: var(--card-bg); border: 1px solid var(--card-border); color: var(--text-muted);
            padding: 8px 18px; border-radius: 20px; cursor: pointer; font-weight: 600; transition: 0.3s; font-size: 13px;
        }
        .tab-btn.active, .tab-btn:hover { background: var(--btn-color); color: white; border-color: var(--btn-color); }

        /* --- GRILLE VÉHICULES --- */
        .vehicle-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 24px; padding: 40px 0 80px;
        }
        .vehicle-card {
            background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 16px;
            overflow: hidden; transition: 0.3s; cursor: pointer;
            box-shadow: 0 10px 20px -10px var(--shadow-tone); display: flex; flex-direction: column;
        }
        .vehicle-card:hover { transform: scale(1.02); border-color: var(--btn-color); }
        .vehicle-img { width: 100%; aspect-ratio: 16/9; object-fit: cover; background-color: #e0e7ff; }
        .vehicle-info { padding: 20px; flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between; }
        .vehicle-garage { color: var(--btn-color); font-size: 11px; font-weight: 800; text-transform: uppercase; margin-bottom: 5px; display: block; }
        .vehicle-name { margin: 0; font-size: 18px; font-weight: 700; color: var(--text-main); }
        .vehicle-tag { font-size: 12px; color: var(--text-muted); margin-top: 5px; }

        /* --- MODALE IMAGE (ZOOM) --- */
        .modal {
            display: none; position: fixed; z-index: 3000; padding-top: 50px; left: 0; top: 0;
            width: 100%; height: 100%; background-color: rgba(10, 5, 20, 0.95); backdrop-filter: blur(8px);
        }
        .modal-content-wrapper {
            margin: auto; display: flex; flex-direction: column; align-items: center;
            width: 90%; max-width: 1000px; position: relative; top: 50%; transform: translateY(-50%);
        }
        .modal-img-container { position: relative; width: 100%; display: flex; align-items: center; justify-content: center; }
        .modal-img {
            width: 100%; max-height: 70vh; object-fit: contain; border-radius: 12px;
            border: 1px solid #ffffff30; box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        .nav-btn {
            position: absolute; top: 50%; transform: translateY(-50%);
            background: rgba(0,0,0,0.5); color: white; border: 1px solid rgba(255,255,255,0.2);
            width: 50px; height: 50px; border-radius: 50%; font-size: 24px; cursor: pointer;
            display: flex; align-items: center; justify-content: center; z-index: 2010; transition: 0.2s;
        }
        .nav-btn:hover { background: var(--btn-color); border-color: var(--btn-color); }
        .prev-btn { left: 10px; } .next-btn { right: 10px; }
        .modal-details { margin-top: 20px; color: white; text-align: center; }
        .modal-desc {
            font-size: 16px; color: var(--btn-color); background: #ffffff;
            display: inline-block; padding: 8px 20px; border-radius: 50px; font-weight: 600; margin-top: 10px;
        }
        .close { position: absolute; top: 20px; right: 30px; color: #fff; font-size: 40px; cursor: pointer; z-index: 2001; }

        /* --- MODALE FILTRES (CAPSULES) --- */
        .filter-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(4px); z-index: 2500;
            align-items: center; justify-content: center;
        }
        .filter-modal.active { display: flex; }
        .filter-box {
            background: white; width: 90%; max-width: 500px; border-radius: 20px; padding: 30px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); animation: popIn 0.3s ease;
        }
        @keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        .filter-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #f3f4f6; padding-bottom: 15px; }
        .filter-header h2 { font-size: 20px; font-weight: 700; margin: 0; color: var(--text-main); }
        .close-filter { background: none; border: none; font-size: 24px; color: var(--text-muted); cursor: pointer; }

        .filter-group-title { font-size: 13px; font-weight: 700; text-transform: uppercase; color: var(--text-muted); margin-bottom: 10px; margin-top: 15px; }
        .options-grid { display: flex; flex-wrap: wrap; gap: 8px; }
        .options-grid input[type="radio"] { display: none; }
        .options-grid label {
            padding: 8px 16px; background-color: #f9fafb; border: 1px solid #e5e7eb;
            border-radius: 50px; font-size: 14px; color: var(--text-main); cursor: pointer; transition: all 0.2s;
        }
        .options-grid label:hover { background-color: #f3f4f6; border-color: var(--card-border); }
        .options-grid input[type="radio"]:checked + label {
            background-color: var(--btn-color); border-color: var(--btn-color); color: white;
        }
        .filter-actions { margin-top: 30px; display: flex; justify-content: flex-end; gap: 10px; }
        .btn-apply { background: var(--text-main); border: none; padding: 10px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; color: white; }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="nav-inner">
            <a href="index.html" class="logo">ITSMTO</a>
            <div class="nav-links">
                <a href="index.html">Accueil</a>
                <a href="vehicules.html" class="active">Garage</a>
                <a href="socials.html">Réseaux</a>
            </div>
            <button class="menu-toggle" onclick="toggleMobileMenu()">☰</button>
        </div>
    </nav>

    <div id="mobileMenu" class="mobile-menu">
        <button class="close-menu" onclick="toggleMobileMenu()">×</button>
        <a href="index.html">Accueil</a>
        <a href="vehicules.html">Garage</a>
        <a href="socials.html">Réseaux</a>
    </div>

    <div class="container">
        <div class="search-section">
            <h1 style="margin-bottom: 20px; color:var(--text-main);">Mon Catalogue</h1>
            
            <div class="search-wrapper">
                <input type="text" id="searchInput" class="search-input" placeholder="Rechercher une voiture...">
                <button id="openFilterBtn" class="advanced-filter-btn">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                    </svg>
                    Filtres
                </button>
            </div>
            
            <div class="garage-tabs">
                <button class="tab-btn active" data-garage="all">Tous</button>
                <button class="tab-btn" data-garage="arenerdc">Arène RDC</button>
                <button class="tab-btn" data-garage="arène-1">Arène 1</button>
                <button class="tab-btn" data-garage="arène-2">Arène 2</button>
                <button class="tab-btn" data-garage="fonction-2">Fonction 2</button>
                <button class="tab-btn" data-garage="fonction-3">Fonction 3</button>
            </div>
        </div>

        <div id="galleryGrid" class="vehicle-grid">
            </div>
    </div>

    <div id="vehicleModal" class="modal">
        <span class="close" onclick="closeModal()">&times;</span>
        <div class="modal-content-wrapper">
            <div class="modal-img-container">
                <button id="prevBtn" class="nav-btn prev-btn" onclick="changeImage(-1)">&#10094;</button>
                <img class="modal-img" id="modalImg" src="" alt="Véhicule">
                <button id="nextBtn" class="nav-btn next-btn" onclick="changeImage(1)">&#10095;</button>
            </div>
            <div class="modal-details">
                <div id="modalTitle" style="font-size:32px; font-weight:700; margin-bottom:5px;"></div>
                <div id="modalDesc" class="modal-desc"></div>
            </div>
        </div>
    </div>

    <div id="filterModal" class="filter-modal">
        <div class="filter-box">
            <div class="filter-header">
                <h2>Filtres Avancés</h2>
                <button id="closeFilter" class="close-filter">&times;</button>
            </div>
            <form id="filterForm">
                <div class="filter-group-title">Type de Roues</div>
                <div class="options-grid">
                    <input type="radio" id="w-all" name="wheel" value="all" checked>
                    <label for="w-all">Toutes</label>
                    <input type="radio" id="w-f1" name="wheel" value="F1">
                    <label for="w-f1">F1</label>
                    <input type="radio" id="w-benny" name="wheel" value="Benny">
                    <label for="w-benny">Benny's</label>
                </div>

                <div class="filter-group-title">Plaques</div>
                <div class="options-grid">
                    <input type="radio" id="p-all" name="plate" value="all" checked>
                    <label for="p-all">Toutes</label>
                    <input type="radio" id="p-yank" name="plate" value="Yankton">
                    <label for="p-yank">Yankton</label>
                    <input type="radio" id="p-perso" name="plate" value="Perso">
                    <label for="p-perso">Perso</label>
                </div>

                <div class="filter-group-title">Fumées</div>
                <div class="options-grid">
                    <input type="radio" id="s-all" name="smoke" value="all" checked>
                    <label for="s-all">Toutes</label>
                    <input type="radio" id="s-patriot" name="smoke" value="Patriotique">
                    <label for="s-patriot">Patriote</label>
                    <input type="radio" id="s-color" name="smoke" value="Classique">
                    <label for="s-color">Colorée</label>
                </div>

                <div class="filter-actions">
                    <button type="submit" class="btn-apply">Appliquer</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        function toggleMobileMenu() {
            const m = document.getElementById('mobileMenu');
            m.style.display = (m.style.display === 'flex') ? 'none' : 'flex';
        }

        // LISTE DES VÉHICULES AVEC VRAIES IMAGES LOCALES
        const vehicles = [
            // --- 1. ARENE RDC ---
            { name: "Ubermacht Niobe", images: ["mod/arenerdc/Niobe.jpg", "mod/arenerdc/Niobe1.jpg", "mod/arenerdc/Niobe2.jpg"], tag: "Couleur Moddée • Jantes Moddées", garage: "arenerdc" },
            { name: "Obey 8F Drafter", images: ["mod/arenerdc/8F Drafter.jpg", "mod/arenerdc/8F Drafter1.jpg", "mod/arenerdc/8F Drafter2.jpg"], tag: "Pneus F1 • Plaque Yankton", garage: "arenerdc" },

            // --- 2. ARENE 1 ---
            { name: "Apocalypse Cerberus", images: ["mod/arene1/Cerberus anticipation.jpg"], tag: "Plaque Yankton 'Manu' • Fumée Blanche", garage: "arène-1" },
            { name: "Coil Cyclone", images: ["mod/arene1/Cyclone.jpg"], tag: "Jantes Benny's • Vitres Moddées", garage: "arène-1" },
            { name: "Apocalypse ZR380", images: ["mod/arene1/ZR380 anticipation.jpg"], tag: "Jantes Benny's • Plaque Yankton", garage: "arène-1" },
            { name: "Apocalypse Bruiser", images: ["mod/arene1/Bruiser anticipation.jpg"], tag: "Pneus F1 • Fumée Patriotique", garage: "arène-1" },
            { name: "Pegassi Zentorno", images: ["mod/arene1/Zentorno.jpg"], tag: "Fumée Bleu Classique", garage: "arène-1" },
            { name: "Dinka Jester", images: ["mod/arene1/Jester.jpg"], tag: "Fumée Rose Classique", garage: "arène-1" },
            { name: "Benefactor Krieger", images: ["mod/arene1/Krieger.jpg"], tag: "Roues F1 • Fumée Patriotique", garage: "arène-1" },
            { name: "Ubermacht Rhinehart", images: ["mod/arene1/Rhinehart.jpg", "mod/arene1/Rhinehart1.jpg"], tag: "Roues F1 • Vitres Moddées", garage: "arène-1" },
            { name: "Invetero Coquette D10", images: ["mod/arene1/D10.jpg"], tag: "Non Moddé", garage: "arène-1" },
            { name: "Grotti Itali RSX", images: ["mod/arene1/RSX.jpg", "mod/arene1/RSX1.jpg"], tag: "Full Moddé • Plaque Yankton", garage: "arène-1" },
            
            // --- 3. ARENE 2 ---
            { name: "Benefactor Schlagen GT", images: ["mod/arene2/Schlagen GT.jpg"], tag: "Véhicule Moddé", garage: "arène-2" },
            { name: "Annis ZR380 Anticipation", images: ["mod/arene2/ZR380 anticipation.jpg"], tag: "Véhicule Moddé", garage: "arène-2" },
            { name: "Grotti Vigilante", images: ["mod/arene2/Vigilante.jpg"], tag: "Véhicule Moddé", garage: "arène-2" },
            { name: "Progen T20", images: ["mod/arene2/T20.jpg"], tag: "Véhicule Moddé", garage: "arène-2" },
            { name: "Ubermacht Niobe", images: ["mod/arene2/Niobe.jpg"], tag: "Véhicule Moddé", garage: "arène-2" },
            { name: "Dewbauchee Vagner", images: ["mod/arene2/Vagner.jpg"], tag: "Véhicule Moddé", garage: "arène-2" },
            { name: "Benefactor Dubsta", images: ["mod/arene2/Dubsta.jpg"], tag: "Véhicule Moddé", garage: "arène-2" },
            { name: "Albany Hermes", images: ["mod/arene2/Hermes.jpg"], tag: "Véhicule Moddé", garage: "arène-2" },
            { name: "Pegassi Reaper", images: ["mod/arene2/Reaper.jpg"], tag: "Véhicule Moddé", garage: "arène-2" },

            // --- 4. FONCTION 2 ---
            { name: "Elegy Rétro Custom", images: ["mod/fonction2/elegy.jpg"], tag: "Couleur Moddée • Jantes Benny's", garage: "fonction-2" },
            { name: "Benefactor Schlagen GT", images: ["mod/fonction2/schlagen.jpg"], tag: "Couleur Moddée", garage: "fonction-2" },
            { name: "Karin 190z", images: ["mod/fonction2/190z.jpg"], tag: "Plaque Yankton • Pneus F1", garage: "fonction-2" },
            { name: "Ubermacht Cypher", images: ["mod/fonction2/Cypher.jpg"], tag: "Couleur Moddée", garage: "fonction-2" },
            { name: "Albany Roosevelt Valor", images: ["mod/fonction2/Valor.jpg"], tag: "Pneus F1", garage: "fonction-2" },
            { name: "Canis Kalahari", images: ["mod/fonction2/Kalahari.jpg"], tag: "Couleur Moddée", garage: "fonction-2" },
            { name: "Bravado Rat-Loader", images: ["mod/fonction2/Bravado.jpg"], tag: "Arrière Invisible", garage: "fonction-2" },
            { name: "Corbillard Romero", images: ["mod/fonction2/Romero.jpg"], tag: "Couleur Moddée", garage: "fonction-2" },
            { name: "Albany Brigham", images: ["mod/fonction2/Brigham.jpg"], tag: "Noir Classique", garage: "fonction-2" },
            { name: "Grotti Itali RSX", images: ["mod/fonction2/Itali.jpg"], tag: "Couleur Moddée", garage: "fonction-2" },
            { name: "RUNE Zhaba", images: ["mod/fonction2/Zhaba.jpg"], tag: "Couleur Moddée", garage: "fonction-2" },
            { name: "Weeny Dynasty", images: ["mod/fonction2/Dynasty.jpg"], tag: "Véhicule Moddé", garage: "fonction-2" },
            { name: "Willard Eudora", images: ["mod/fonction2/Eudora.jpg"], tag: "Véhicule Moddé", garage: "fonction-2" },
            { name: "Enus Paragon S", images: ["mod/fonction2/Paragon S.jpg"], tag: "Couleur Moddée", garage: "fonction-2" },
            { name: "Coquette D5", images: ["mod/fonction2/D5.jpg"], tag: "Véhicule Moddé", garage: "fonction-2" },
            { name: "Caddie", images: ["mod/fonction2/Caddie.jpg"], tag: "Couleur Moddée", garage: "fonction-2" },
            { name: "Schlagen GT (2)", images: ["mod/fonction2/Schlagen GT.jpg"], tag: "Couleur Moddée", garage: "fonction-2" },
            { name: "Overflod Pipistrello", images: ["mod/fonction2/Pipistrello.jpg"], tag: "Couleur Moddée", garage: "fonction-2" },
            { name: "BF Raptor", images: ["mod/fonction2/Raptor.jpg"], tag: "Couleur Moddée", garage: "fonction-2" },
            { name: "Grotti Itali GTO", images: ["mod/fonction2/Itali GTO.jpg"], tag: "Couleur Moddée", garage: "fonction-2" },
            
            // --- 5. FONCTION 3 ---
            { name: "Hot Rod Blazer", images: ["mod/fonction3/Blazer.jpg"], tag: "Véhicule Moddé", garage: "fonction-3" },
            { name: "Blista Kanjo", images: ["mod/fonction3/Blista Kanjo.jpg"], tag: "Véhicule Moddé", garage: "fonction-3" },
            { name: "Canis Bodhi", images: ["mod/fonction3/Bodhi.jpg"], tag: "Véhicule Moddé", garage: "fonction-3" },
            { name: "Karin Calico GTF", images: ["mod/fonction3/Calico GTF.jpg"], tag: "Véhicule Moddé", garage: "fonction-3" },
            { name: "Canis Castigator", images: ["mod/fonction3/Castigator.jpg"], tag: "Véhicule Moddé", garage: "fonction-3" },
            { name: "Coil Cyclone II", images: ["mod/fonction3/Cyclone II.jpg"], tag: "Véhicule Moddé", garage: "fonction-3" },
            { name: "MTL Dune", images: ["mod/fonction3/Dune.jpg"], tag: "Véhicule Moddé", garage: "fonction-3" },
            { name: "Vapid Hotknife", images: ["mod/fonction3/Hotknife.jpg"], tag: "Véhicule Moddé", garage: "fonction-3" },
            { name: "Blista Go Go Monkey", images: ["mod/fonction3/monkey.jpg"], tag: "Véhicule Moddé", garage: "fonction-3" },
            { name: "Imponte Nightshade", images: ["mod/fonction3/Nightshade.jpg"], tag: "Véhicule Moddé", garage: "fonction-3" },
            { name: "Benefactor Panto", images: ["mod/fonction3/Panto.jpg"], tag: "Véhicule Moddé", garage: "fonction-3" },
            { name: "Ubermacht Revolter", images: ["mod/fonction3/Revolter.jpg"], tag: "Véhicule Moddé", garage: "fonction-3" },
            { name: "HVY Scarab", images: ["mod/fonction3/Scarab anticipation.jpg"], tag: "Véhicule Moddé", garage: "fonction-3" },
            { name: "Blazer Street", images: ["mod/fonction3/street.jpg"], tag: "Véhicule Moddé", garage: "fonction-3" },
            { name: "Dinka Sugoi", images: ["mod/fonction3/Sugoi.jpg"], tag: "Véhicule Moddé", garage: "fonction-3" },
            { name: "Turismo Classique", images: ["mod/fonction3/Turismo classique.jpg"], tag: "Véhicule Moddé", garage: "fonction-3" },
            { name: "Emperor Vectre", images: ["mod/fonction3/Vectre.jpg"], tag: "Véhicule Moddé", garage: "fonction-3" },
            { name: "Bravado Verlierer", images: ["mod/fonction3/Verlierer.jpg"], tag: "Véhicule Moddé", garage: "fonction-3" },
            { name: "ZR380 Anticipation", images: ["mod/fonction3/ZR380 anticipation.jpg"], tag: "Véhicule Moddé", garage: "fonction-3" }
        ];

        // --- ETAT GLOBAL ---
        let currentVehicle = null;
        let currentImageIndex = 0;
        let currentGarage = 'all';
        let currentFilters = { wheel: 'all', plate: 'all', smoke: 'all' };

        const grid = document.getElementById('galleryGrid');
        const searchInput = document.getElementById('searchInput');
        const tabBtns = document.querySelectorAll('.tab-btn');
        
        // Modal Elements
        const modal = document.getElementById("vehicleModal");
        const modalImg = document.getElementById("modalImg");
        const modalTitle = document.getElementById("modalTitle");
        const modalDesc = document.getElementById("modalDesc");
        const prevBtn = document.getElementById("prevBtn");
        const nextBtn = document.getElementById("nextBtn");

        // Filter Modal Elements
        const filterModal = document.getElementById('filterModal');
        const openFilterBtn = document.getElementById('openFilterBtn');
        const closeFilterBtn = document.getElementById('closeFilter');
        const filterForm = document.getElementById('filterForm');

        // --- GESTION MODALE FILTRES ---
        openFilterBtn.addEventListener('click', () => { filterModal.classList.add('active'); });
        closeFilterBtn.addEventListener('click', () => { filterModal.classList.remove('active'); });
        filterModal.addEventListener('click', (e) => {
            if (e.target === filterModal) filterModal.classList.remove('active');
        });

        // --- GESTION MODALE IMAGE ---
        function openImageModal(vehicle) {
            currentVehicle = vehicle;
            currentImageIndex = 0;
            updateImageModal();
            modal.style.display = "block"; 
        }

        function updateImageModal() {
            if (!currentVehicle) return;
            modalImg.src = currentVehicle.images[currentImageIndex];
            modalTitle.innerText = currentVehicle.name;
            modalDesc.innerText = currentVehicle.tag;

            if (currentVehicle.images.length > 1) {
                prevBtn.style.display = "flex";
                nextBtn.style.display = "flex";
            } else {
                prevBtn.style.display = "none";
                nextBtn.style.display = "none";
            }
        }

        window.changeImage = function(direction) {
            currentImageIndex += direction;
            if (currentImageIndex >= currentVehicle.images.length) currentImageIndex = 0;
            else if (currentImageIndex < 0) currentImageIndex = currentVehicle.images.length - 1;
            updateImageModal();
        }

        function closeModal() { modal.style.display = "none"; }
        window.onclick = function(event) { if (event.target == modal) closeModal(); }

        // --- RENDER & LOGIQUE FILTRE ---
        function render() {
            grid.innerHTML = '';
            const search = searchInput.value.toLowerCase();
            let count = 0;

            vehicles.forEach((v) => {
                // Filtre Recherche Textuelle
                const matchSearch = v.name.toLowerCase().includes(search);
                
                // Filtre Onglet Garage
                const matchGarage = (currentGarage === 'all' || v.garage === currentGarage);

                // Filtres Avancés (Recherche dans les Tags)
                const vTags = v.tag.toLowerCase();
                const matchWheel = (currentFilters.wheel === 'all' || vTags.includes(currentFilters.wheel.toLowerCase()));
                const matchPlate = (currentFilters.plate === 'all' || vTags.includes(currentFilters.plate.toLowerCase()));
                const matchSmoke = (currentFilters.smoke === 'all' || vTags.includes(currentFilters.smoke.toLowerCase()));

                if (matchSearch && matchGarage && matchWheel && matchPlate && matchSmoke) {
                    const card = document.createElement('div');
                    card.className = 'vehicle-card';
                    card.onclick = function() { openImageModal(v); };
                    
                    const garageName = v.garage.replace(/-/g, ' ').toUpperCase();

                    card.innerHTML = `
                        <img src="${v.images[0]}" class="vehicle-img" alt="${v.name}" loading="lazy">
                        <div class="vehicle-info">
                            <div>
                                <span class="vehicle-garage">${garageName}</span>
                                <h3 class="vehicle-name">${v.name}</h3>
                                <div class="vehicle-tag">${v.tag}</div>
                            </div>
                        </div>
                    `;
                    grid.appendChild(card);
                    count++;
                }
            });

            if (count === 0) {
                grid.innerHTML = '<div style="grid-column:1/-1; text-align:center; padding:40px; color:var(--text-muted);">Aucun véhicule trouvé avec ces critères.</div>';
            }
        }

        // Listeners
        searchInput.addEventListener('input', render);

        tabBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                tabBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentGarage = btn.getAttribute('data-garage');
                render();
            });
        });

        // Appliquer filtres avancés
        filterForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(filterForm);
            currentFilters.wheel = formData.get('wheel');
            currentFilters.plate = formData.get('plate');
            currentFilters.smoke = formData.get('smoke');
            
            // On ferme la modale et on relance le rendu
            filterModal.classList.remove('active');
            render();
            
            // Feedback visuel sur le bouton
            if(currentFilters.wheel !== 'all' || currentFilters.plate !== 'all' || currentFilters.smoke !== 'all') {
                openFilterBtn.classList.add('active-filter');
                openFilterBtn.innerHTML = `Filtres (Actifs)`;
            } else {
                openFilterBtn.classList.remove('active-filter');
                openFilterBtn.innerHTML = `
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                    </svg> Filtres`;
            }
        });

        // Init
        render();

    </script>
</body>
</html>